# Аналіз продуктивності Sewing-Manager

## Методологія профілювання

### Інструменти профілювання
Для аналізу продуктивності використано наступні інструменти:
- **Visual Studio Diagnostic Tools**: Вбудоване профілювання CPU та пам’яті під час виконання додатка.
- **MiniProfiler**: Моніторинг запитів до бази даних (Entity Framework Core) та часу обробки HTTP-запитів.
- **dotTrace**: Детальний аналіз "гарячих точок" у коді (JetBrains).

### Ключові метрики продуктивності
Для додатка **Sewing-Manager**, який керує швейними проєктами, визначено такі метрики:
- **Час обробки SignalR-запитів**: Час на передачу даних між клієнтом і сервером через SignalR.
- **Використання CPU**: Час виконання ключових методів (рендеринг компонентів, обробка даних).
- **Використання пам’яті**: Обсяг пам’яті, виділений для компонентів і даних.
- **Час виконання запитів до БД**: Тривалість запитів Entity Framework Core (якщо БД використовується).
- **Час рендерингу UI**: Час на оновлення компонентів Blazor.

### Тестові сценарії
Створено три тестові сценарії для імітації типових дій користувача:
1. **Навігація між сторінками**:
   - Перехід між домашньою сторінкою та сторінкою списку проєктів (100 ітерацій).
   - Метрика: час обробки SignalR-запитів, використання CPU.
2. **Завантаження списку проєктів**:
   - Завантаження 1000 тестових записів про швейні проєкти.
   - Метрика: час виконання запиту до БД, час рендерингу компонентів.
3. **Обробка форми**:
   - Надсилання форми створення/редагування проєкту (50 ітерацій).
   - Метрика: час виконання, використання пам’яті.

**Тестовий набір даних**:
- Тестова база даних із 1000 записів (ID, назва, опис, дати).
- Симуляція 100 навігацій.
- 50 надсилань форм із даними про проєкт.

## Налаштування інструментів

1. **Visual Studio Diagnostic Tools**:
   - Увімкнено профілювання CPU та пам’яті (Debug > Windows > Show Diagnostic Tools).
   - Налаштовано точки зупинки для збору даних під час виконання тестових сценаріїв.
2. **MiniProfiler**:
   - Встановлено NuGet-пакет `MiniProfiler.AspNetCore`.
   - Додано конфігурацію в `Startup.cs`:
     ```csharp
     public void ConfigureServices(IServiceCollection services)
     {
         services.AddMiniProfiler(options => options.RouteBasePath = "/profiler").AddEntityFramework();
     }
     public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
     {
         app.UseMiniProfiler();
     }
     ```
   - Виведення результатів профілювання на сторінці через `/profiler`.
3. **dotTrace**:
   - Налаштовано профілювання вебдодатка через IIS Express.
   - Зібрано дані про час виконання методів і "гарячі точки".

## Результати профілювання

Профілювання виконано на локальному середовищі з імітацією тестових сценаріїв. Нижче наведено результати.

### Тест 1: Навігація між сторінками
- **Час виконання**: Середній час обробки SignalR-запиту — 120 мс.
- **Використання CPU**: 15% від загального часу витрачено на метод `NavigationManager.NavigateTo`.
- **Використання пам’яті**: Пік 50 МБ під час переходів.
- **Проблема**: Часті виклики `StateHasChanged` у компонентах, що викликають надлишковий рендеринг.

### Тест 2: Завантаження списку проєктів
- **Час виконання**: Запит до БД (1000 записів) — 450 мс, рендеринг компонентів — 300 мс.
- **Використання CPU**: 30% часу витрачено на метод `DbContext.Projects.ToListAsync()`.
- **Використання пам’яті**: Пік 120 МБ через завантаження всіх записів у пам’ять.
- **Проблема**: Відсутність пагінації, що спричиняє повне завантаження даних.

### Тест 3: Обробка форми
- **Час виконання**: Середній час обробки форми — 200 мс.
- **Використання CPU**: 10% часу на валідацію даних у `OnValidSubmit`.
- **Використання пам’яті**: Стабільне використання 60 МБ.
- **Проблема**: Надлишкові алокації об’єктів під час серіалізації даних форми.

### Виявлені "гарячі точки"
1. **Метод `StateHasChanged`**:
   - Часті виклики в компонентах під час навігації та оновлення UI.
   - Частка часу: ~20% від загального часу виконання.
2. **Метод `DbContext.Projects.ToListAsync`**:
   - Завантаження великих наборів даних без пагінації.
   - Частка часу: ~25% у тесті завантаження списку.
3. **Метод `NavigationManager.NavigateTo`**:
   - Повторні виклики під час швидкої навігації.
   - Частка часу: ~15% у тесті навігації.

## Виявлені проблеми з продуктивністю
1. **Надлишковий рендеринг компонентів**:
   - Проблема: Часті виклики `StateHasChanged` у компонентах, особливо під час навігації.
   - Рекомендація: Використовувати `ShouldRender` для оптимізації рендерингу.
2. **Відсутність пагінації в запитах до БД**:
   - Проблема: Завантаження всіх записів одночасно збільшує час виконання та споживання пам’яті.
   - Рекомендація: Впровадити пагінацію (наприклад, `Skip`/`Take` в Entity Framework).
3. **Неоптимізована обробка навігації**:
   - Проблема: Повторні виклики `NavigateTo` спричиняють затримки в SignalR.
   - Рекомендація: Додати дебонсинг для подій навігації.

## Висновки
Проведене профілювання виявило ключові проблемні місця в **Sewing-Manager**, пов’язані з рендерингом UI, запитами до бази даних і навігацією. Впровадження пагінації, оптимізація рендерингу та дебонсинг навігаційних подій значно покращать продуктивність. Подальші кроки включають повторне профілювання після внесення змін для оцінки покращень.
